# libs/git
#
# Functions to control the project source code.
#
# Author: Jiajun Liu <jiajun@unitedstack.com>
#

# git_clone remote srcdir
git_clone() {
    local remote=$1
    local srcdir=$2

    git clone --recursive ${remote} "${srcdir}"
    pushd "${srcdir}"
    git remote set-url origin ${remote}
    git reset --hard HEAD
    popd
}


# get_fetch_tag srcdir
git_fetch_tag() {
    local srcdir=$1

    pushd "${srcdir}"
    git fetch origin --tags
    popd
}


# get_fetch_tag srcdir
git_fetch_tag() {
    local srcdir=$1

    pushd "${srcdir}"
    git fetch origin
    popd
}


# git_update_branch branch
git_update_branch() {
    local srcdir=$1
    local branch=$2

    pushd "${srcdir}"
    git fetch origin
    # check if branch exists on remote
    git show origin/${branch} > /dev/null 2>&1
    if [ $? -ne 0 ]; then
        die "branch ${branch} do NOT exists, aborting..."
    fi
    # checkout branch by force
    git checkout -f origin/${branch} > /dev/null 2>&1
    # a local branch might not exist
    git branch -D ${branch} || true
    git checkout -b ${branch}
    popd
}
